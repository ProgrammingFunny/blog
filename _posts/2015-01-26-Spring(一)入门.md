---
layout: blog
title:  "Spring(一): 入门"
date:   2015-01-26 
category: Spring  
comments: true
---


*****

## 本文结构

* [Spring框架简介](#instruction)
* [Spring简单项目示例](#example)

*****

<h2 id="instruction"> Spring框架简介 </h2>

Spring是一个开源框架，主要优势是其分层架构，由7个模块组成。网上找了个Spring的结构图

![Spring框架的7个模块]({{ "/assets/images/spring_framework.gif"  | prepend: site.baseurl }} "Spring框架的7个模块")

Spring框架的每个模块（或组件）都可以单独存在，或者与其他一个或多个模块联合实现，包括与Struts等MVC框架或Hibernate等ORM框架的集成。每个模块介绍如下：

* `Spring Core`: 核心容器提供 Spring 框架的基本功能。核心容器的主要组件是`BeanFactory`，它是工厂模式的实现。`BeanFactory`使用*控制反转*（IOC） 模式将应用程序的配置和依赖性规范与实际的应用程序代码分开。
* `Spring Context`: Spring 上下文是一个配置文件，向 Spring 框架提供上下文信息。Spring 上下文包括企业服务，例如 JNDI、EJB、电子邮件、国际化、校验和调度功能。
* `Spring AOP`: 该模块直接将面向方面的编程功能集成到了 Spring 框架中，通过使用 Spring AOP，不用依赖 EJB 组件，就可以将声明性事务管理集成到应用程序中。
* `Spring DAO`: JDBC DAO 抽象层提供了有意义的异常层次结构，可用该结构来管理异常处理和不同数据库抛出的错误消息。
* `Spring ORM`: Spring 框架插入了若干个 ORM 框架，从而提供了 ORM 的对象关系工具，其中包括 JDO、Hibernate 和 iBatis SQL Map。所有这些都遵从 Spring 的通用事务和 DAO 异常层次结构。
* `Spring Web`: Web 上下文模块建立在应用程序上下文模块之上，为基于 Web 的应用程序提供了上下文。Web 模块还简化了处理多部分请求以及将请求参数绑定到域对象的工作。
* `Spring Web MVC`: MVC 框架是一个全功能的构建 Web 应用程序的 MVC 实现。MVC 容纳了大量视图技术，其中包括 JSP、Velocity、Tiles、iText 和 POI。

### 控制反转(IoC)和依赖注入
**控制反转**(Inversion of Control)和**依赖注入**(Dependency Injection)意思差不多。当某个实例(调用者)需要调用另一个实例(被调用者)时，之前是通过调用者来创建被调用者的实例(new一个实例)，现在创建被调用者的工作交给Spring的容器来完成，称为“控制反转”。
我们描述创建被调用者的方式，由IoC容器来创建管理对象，然后注入到调用者中去，这就是“依赖注入“。注入的方式有通过`JavaBean`属性(setter方法)注入和通过构造方法注入。

### 面向方面编程(AOP)
面向方面的编程，即 AOP(Aspect Oriented Programming)，是一种编程技术，它允许程序员对横切关注点或横切典型的职责分界线的行为进行模块化（例如日志和事务管理）。AOP 的核心构造是方面，它将那些影响多个类的行为封装到可重用的模块中。
AOP 和 IOC 是补充性的技术，它们都运用模块化方式解决企业应用程序开发中的复杂问题。在典型的面向对象开发方式中，可能要将日志记录语句放在所有方法和 Java 类中才能实现日志功能。在 AOP 方式中，可以反过来将日志服务模块化，并以声明的方式将它们应用到需要日志的组件上。当然，优势就是 Java 类不需要知道日志服务的存在，也不需要考虑相关的代码。所以，用 Spring AOP 编写的应用程序代码是松散耦合的。
AOP 的功能完全集成到了 Spring 事务管理、日志和其他各种特性的上下文中。

*****

<h2 id="example"> Spring简单项目示例 </h2>

`BeanFactory`是 Spring 作为 IOC 容器核心接口，`ApplicationContext`是`BeanFactory`的扩展，功能得到了进一步增强。  
下面是一个简单的Spring的例子
目录结构如下:

```
    src
    |--com.test.spring
    |  |--dao
    |  |  |--impl
    |  |  |  |--HelloImpl.java
    |  |  |--Hello.java
    |  |--service
    |  |  |--impl
    |  |  |  |--HelloServiceImpl.java
    |  |  |--HelloService.java
    |  |--TestSpring.java
    resources
    |--spring.xml
```

源文件内容如下:

```java
// Hello.java
public interface Hello {
    public void sayHello();
}

// HelloImpl.java
public class HelloImpl implements Hello{
    public void sayHello(){
        System.out.println("Hello!");
    }
}

// HelloService.java
public interface HelloService {
    public void testHello();
}

// HelloServiceImpl.java
public class HelloServiceImpl implements HelloService{
    private Hello hello;
    // setter 方法必须写，否则无法注入
    public void setHello(Hello hello) {
        this.hello = hello;
    }
    @Override
    public void testHello() {
        hello.sayHello();
    }
}

//TestSpring.java
public class TestSpring {
    public static void main(String[] args) {
        // 读取 classpath 下面的配置文件，实例化容器
        ApplicationContext context = new ClassPathXmlApplicationContext("spring.xml");

        // 这里的字符串是配置文件中通过id指定的
        Hello hello =context.getBean("hello", HelloImpl.class);
//        Hello hello = (Hello) context.getBean("helloImpl");
        hello.sayHello();

        // 注入到HelloServiceImpl 中的 hello 属性中
        HelloService helloService = context.getBean("helloService", HelloService.class);
        helloService.testHello();
    }
}
```

配置文件`spring.xml`内容如下

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
            http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/tx
            http://www.springframework.org/schema/tx/spring-tx.xsd
            http://www.springframework.org/schema/context
            http://www.springframework.org/schema/context/spring-context-3.0.xsd">

    <bean id="hello" class="com.test.spring.dao.impl.HelloImpl"></bean>

    <bean id="helloService" class="com.test.spring.service.impl.HelloServiceImpl">
        <property name="hello" ref="hello"/>
    </bean>

</beans>
```

*****
